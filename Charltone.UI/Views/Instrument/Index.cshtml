@using Charltone.UI.ViewModels.Instrument;

@model InstrumentListViewModel

@{
    ViewBag.Title = "Charltone Instruments";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    $(document).ready(function () {
        position.set();
    });
</script>

<div id="carousel-container"></div>
<div id="instrlist">
    <div class="container-fluid">
        <div class="row">
            <div id="instrlist-banner" class="col-md-8">
                <h4>@Model.Banner</h4>
            </div>

            <div class="col-md-4">
                <span class="pull-right">
                    <button class="btn btn-info btn-sm" type="button" onclick='javascript:instrument.carousel.show();'>View Slides</button>

                    @if (Request.IsAuthenticated)
                    {
                        <button class="btn btn-success btn-sm" type="button" onclick="location.href = '@Url.Action("Create", "Instrument")'">Add</button>
                    }
                </span>
            </div>
        </div>
        @{
            var row = 1;
            var totalrows = Model.Instruments.Count();
            var detailsLabel = Request.IsAuthenticated ? "Photos" : "Details";

            foreach (var inst in Model.Instruments)
            {
                if (row == 1)
                {
                    <div class="row">
                        <div class="col-md-12">
                            <div class="linehorizontal"></div>
                        </div>
                    </div>
                }

                var rowClass = (0 == (row % 3) || row == totalrows) ? "row" : null;
                <div class="@rowClass">
                    <div id="instrlist-item" class="col-md-4">
                        <div>
                            <label class="label label-@inst.StatusCssClass">
                                @(inst.ShowPrice ? inst.Price : inst.Status)
                            </label>
                        </div>
                        <a id="@string.Format("img_{0}", @inst.DefaultPhotoId)" href="@Url.Action("Detail", "Instrument", new { id = @inst.ProductId })">
                            <img class="img-rounded" src=@Url.Action("GetPhoto", "Instrument", new InstrumentPhotoModel {
                                                                                                                                        PhotoId = inst.DefaultPhotoId,
                                                                                                                                        Width = Convert.ToInt32(@Model.MaxImageWidth),
                                                                                                                                        Height = Convert.ToInt32(@Model.MaxImageHeight)}) alt="" />
                        </a>
                        <h4>@inst.ModelSn</h4>
                        <span>@inst.Classification / @inst.SubClassification</span>
                        <div>
                            @if (Request.IsAuthenticated)
                            {
                                <button class="btn btn-primary btn-xs" type="button" onclick="location.href='@Url.Action("Edit", "Instrument", new { id = inst.ProductId })'">Edit</button>

                            }
                            <button class="btn btn-info btn-xs" type="button" onclick="location.href='@Url.Action("Detail", "Instrument", new { id = inst.ProductId })'">@detailsLabel</button>
                            <label class="label label-danger">@inst.NotPostedMessage</label>
                        </div>

                    </div>
                </div>

                if ("row" == @rowClass)
                {
                    <div class="row">
                        <div class="col-md-12">
                            <div class="linehorizontal"></div>
                        </div>
                    </div>
                }
                row++;
            }
        }
    </div>
    <div id='dialog-image-container'></div>
</div>